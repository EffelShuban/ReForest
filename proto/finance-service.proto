syntax = "proto3";

package finance;

option go_package = "reforest/pkg/pb";

import "google/protobuf/empty.proto";

service FinanceService {
  rpc CreateTransaction(TransactionRequest) returns (Transaction);
  rpc TopUpWallet(google.protobuf.Empty) returns (PaymentUrlResponse);
  rpc HandleWalletWebhook(WebhookRequest) returns (google.protobuf.Empty);
  rpc GetBalance(google.protobuf.Empty) returns (BalanceResponse);
  rpc GetTransactionHistory(google.protobuf.Empty) returns (TransactionList);
  
  // Scheduled Jobs
  rpc CheckPaymentExpiry(google.protobuf.Empty) returns (google.protobuf.Empty);
}

enum TransactionType {
  DEPOSIT = 0;
  WITHDRAWAL = 1;
  PURCHASE = 2;
}

message TransactionRequest {
  string user_id = 1;
  int64 amount = 2;
  TransactionType type = 3;
}

message Transaction {
  string id = 1;
  string user_id = 2;
  int64 amount = 3;
  TransactionType type = 4;
  string status = 5;
}

message TransactionList { repeated Transaction transactions = 1; }

message PaymentUrlResponse { string url = 1; }

message BalanceResponse { double balance = 1; }

message WebhookRequest {
  string event = 1;
  bytes data = 2; // Generic payload from Xendit
}